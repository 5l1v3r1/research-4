/* 
 * $Id: main.c,v 1.1 2010-11-17 16:12:33-02 nbrito Exp $ 
 */

 /* ------------------x------------------x------------------x------------------
 * Author: Nelson Brito <nbrito[at]sekure[dot]org>
 *
 * Copyright (c) 2000-2010 Nelson Brito. All rights reserved worldwide.
 *
 * This file is part of Penetration Test Toolkit.
 * ------------------x------------------x------------------x------------------
            FTPx FTP Explorer Weak Password Encryption Vulnerability
                                  Release 2.00

                      Copyright (c) 2000-2010 Nelson Brito
                               All Rights Reserved
   ------------------x------------------x------------------x------------------ */
#ifndef MAIN_C__
#define MAIN_C__ 1
/* @AUTHOR:	  Nelson Brito
   @REVISION: February 25th, 2000
			  October  20th, 2008
			  November 17th, 2010 */
#include "common.h"

/* XXX - FURTHER INFORMATION - XXX
 * 
 * Title:		FTPx FTP Explorer Weak Password Encryption Vulnerability
 * Bugtraq ID:	1003
   CVE:			CVE-2000-0214
   X-Force:		ftp-explorer-weak-pwd(4038)


[References]
   This vulnerability was discovered by Hever <Hever@vitech.net>
   The reverse engineering applied by Nelson Brito <nbrito@sekure.org>

   Some interesting URLs:
   http://seclists.org/bugtraq/2000/Feb/0415.html
   http://www.securityfocus.com/bid/1003
   http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0214
   http://www.microsoft.com/technet/security/bulletin/MS02-039.asp
   http://xforce.iss.net/xforce/xfdb/4038

[Vulnerability details]
   FTP Explorer includes the option to store profiles of visited FTP sites.
   
   The user's name and password can also be stored. These stored values are
   kept in the registry, under the key:
   - HKCU\Software\FTP Explorer\Profiles\ProfileName\
   
   The password is encrypted, but the encryption mechanism is weak and can
   easily be broken.

   Each character in the password is incremented by 9, then incremented by
   (3(n - 1)), 'n' being the characters position in the password.
   
   Therefore, a password of AAA (A=41) would be stored as:
   - [A+9+3(1-1)] [A+9+3(2-1)] [A+9+3(3-1)], or 4A4D50.

   [NOTE]
   This algorithm does not seem to apply for characters outside the range 
   0x20 - 0x7F. However, it is still possible to make a character based 
   function f(x) such that the algorithm encrypts 'xyz' as:
   - [f(x)+3(1-1)] [f(y)+3(2-1)] [f(z)+3(3-1)].
   
   It is trivial to construct such a function for all 256 possible character
   values with a dictionary approach.

 * XXX - FURTHER INFORMATION - XXX */

/* Main function.
   Call all other functions. */
int main(int argc, char ** argv){
	unsigned int       x = 33;	/* X axis in the password matrix */
	unsigned int       y = 0;	/* Y axis in the password matrix */
	struct options     z;		/* structure to hold the options */

	/* Getting CLI options. */
	z = process_options(argc, argv);

	/* Printing little banner. */
	printf("%s v%s.%s by %s built on %s %s\n\n", program, __MAJOR_VERSION, __MINOR_VERSION, author, __DATE__, __TIME__);

	/* Do stuffs... 8-D */
	(*ftpx)(x, y, z);		/* X, Y, Z? 8-D */

	return(EXIT_SUCCESS);
}
#endif  /* MAIN_C__ */
